<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Pixel</title>
<style>
html,body { margin:0; padding:0; height:100%; background:#70c5ce; overflow:hidden; font-family:sans-serif; }
canvas { display:block; margin:0 auto; background:#70c5ce; image-rendering: pixelated; }
#ui { position:fixed; top:10px; left:10px; color:white; font-weight:bold; text-shadow:0 1px 0 #000; font-size:20px;}
</style>
</head>
<body>
<div id="ui">Pontuação: <span id="score">0</span></div>
<canvas id="game" width="400" height="600"></canvas>
<script>
// ==================== CONFIG ====================
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const GRAVITY = 0.5;
const FLAP = -8;
const PIPE_WIDTH = 60;
const PIPE_GAP = 150;
const PIPE_INTERVAL = 1500; // ms
const BIRD_SIZE = 32;

// ==================== GAME STATE ====================
let bird = { x: 80, y: 300, vy: 0, width: BIRD_SIZE, height: BIRD_SIZE };
let pipes = [];
let lastPipeTime = 0;
let score = 0;
let gameOver = false;

// ==================== INPUT ====================
document.addEventListener('keydown', e=>{
  if(e.code==='Space'){ flap(); e.preventDefault(); }
});
canvas.addEventListener('click', flap);
function flap(){
  if(gameOver) restartGame();
  else bird.vy = FLAP;
}

// ==================== PIPE CREATION ====================
function createPipe(){
  const topHeight = Math.random() * (canvas.height - PIPE_GAP - 100) + 50;
  pipes.push({
    x: canvas.width,
    yTop: topHeight,
    yBottom: topHeight + PIPE_GAP,
    width: PIPE_WIDTH
  });
}

// ==================== COLLISIONS ====================
function checkCollision(pipe){
  if(bird.y < pipe.yTop || bird.y + bird.height > pipe.yBottom){
    if(bird.x + bird.width > pipe.x && bird.x < pipe.x + pipe.width){
      return true;
    }
  }
  return false;
}

// ==================== UPDATE ====================
function update(delta){
  if(gameOver) return;

  // Bird physics
  bird.vy += GRAVITY;
  bird.y += bird.vy;

  if(bird.y + bird.height > canvas.height){
    bird.y = canvas.height - bird.height;
    gameOver = true;
  }
  if(bird.y < 0){
    bird.y = 0;
    bird.vy = 0;
  }

  // Pipes movement
  const now = Date.now();
  if(now - lastPipeTime > PIPE_INTERVAL){
    createPipe();
    lastPipeTime = now;
  }
  pipes.forEach(pipe=>{ pipe.x -= 2; });
  pipes = pipes.filter(pipe=>pipe.x + pipe.width > 0);

  // Collisions
  pipes.forEach(pipe=>{
    if(checkCollision(pipe)){
      gameOver = true;
    }
    // Score
    if(!pipe.passed && pipe.x + pipe.width < bird.x){
      score++; pipe.passed = true;
      document.getElementById('score').textContent = score;
    }
  });
}

// ==================== DRAW ====================
function draw(){
  // Clear
  ctx.fillStyle = '#70c5ce';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Bird
  ctx.fillStyle = '#ff0';
  ctx.fillRect(bird.x, bird.y, bird.width, bird.height);

  // Pipes
  ctx.fillStyle = '#0a0';
  pipes.forEach(pipe=>{
    // Top pipe
    ctx.fillRect(pipe.x,0,pipe.width,pipe.yTop);
    // Bottom pipe
    ctx.fillRect(pipe.x,pipe.yBottom,pipe.width,canvas.height - pipe.yBottom);
  });

  // Ground
  ctx.fillStyle = '#deaa4b';
  ctx.fillRect(0,canvas.height-20,canvas.width,20);

  // Game Over text
  if(gameOver){
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'white';
    ctx.font = '40px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Game Over',canvas.width/2,canvas.height/2);
    ctx.font = '20px sans-serif';
    ctx.fillText('Clique ou SPACE para reiniciar',canvas.width/2,canvas.height/2 + 40);
  }
}

// ==================== RESTART ====================
function restartGame(){
  bird = { x: 80, y: 300, vy: 0, width: BIRD_SIZE, height: BIRD_SIZE };
  pipes = [];
  score = 0;
  gameOver = false;
  document.getElementById('score').textContent = score;
  lastPipeTime = Date.now();
}

// ==================== MAIN LOOP ====================
let last = performance.now();
function loop(now){
  const delta = now - last;
  last = now;
  update(delta);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
